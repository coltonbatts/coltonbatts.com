---
import BaseLayout from '../layouts/BaseLayout.astro';
import ArtSlot from '../components/ArtSlot.astro';
import { artManifest } from '../content/art-manifest';
import { getCollection } from 'astro:content';
import { existsSync } from 'node:fs';
import { resolve } from 'node:path';

const tools = await getCollection('tools');
const featuredTools = tools.slice(0, 2);

function slotHasAsset(src: string) {
	if (!src) return false;
	if (/^https?:\/\//.test(src)) return true;
	return existsSync(resolve(process.cwd(), 'public', src.replace(/^\//, '')));
}

const heroArt = artManifest.hero.enabled && slotHasAsset(artManifest.hero.src) ? artManifest.hero : undefined;
const motionArt =
	artManifest.motion.rive.enabled && slotHasAsset(artManifest.motion.rive.src)
		? artManifest.motion.rive
		: artManifest.motion.poster.enabled && slotHasAsset(artManifest.motion.poster.src)
			? artManifest.motion.poster
			: undefined;
---

<BaseLayout title="Home" description="Toolmaker. Building offline-first tools.">
	<div class="max-w-4xl mx-auto px-6 py-12">
		<section class="mb-16">
			<h1 class="text-3xl font-bold mb-6">Toolmaker</h1>
			<div class="prose prose-lg max-w-none">
				<p class="text-lg leading-relaxed">
					I build tools that work offline, respect your privacy, and don't require subscriptions. 
					No logins, no ads, no tracking. Just software that solves problems. 
					Think workshop manual, not SaaS landing page.
				</p>
			</div>
			<div class="mt-8">
				<ArtSlot slot={heroArt} fallbackLabel="Artwork slot" />
			</div>
		</section>

		<section class="mb-16">
			<h2 class="text-2xl font-semibold mb-6">Featured Tools</h2>
			<div class="grid gap-6 md:grid-cols-2">
				{featuredTools.map((tool) => (
					<a
						href={`/tools/${tool.slug}`}
						class="border border-black p-6 hover:bg-gray-50 transition-colors block tool-card"
					>
						<ArtSlot
							slot={artManifest.tools[tool.slug]}
							fallbackLabel="Artwork slot"
							class="mb-4"
						/>
						<h3 class="text-xl font-semibold mb-2">{tool.data.name}</h3>
						<p class="text-gray-700 mb-4">{tool.data.oneLiner}</p>
						<div class="flex items-center gap-2">
							<span
								class="text-xs px-2 py-1 border border-black"
								class:list={{
									'bg-black text-white': tool.data.status === 'active',
									'bg-gray-100': tool.data.status === 'beta',
									'bg-gray-200': tool.data.status === 'archived',
								}}
							>
								{tool.data.status}
							</span>
							<span class="text-xs text-gray-600">{tool.data.platform}</span>
						</div>
					</a>
				))}
			</div>
		</section>

		<section class="mb-16">
			<h2 class="text-2xl font-semibold mb-6">Motion</h2>
			<ArtSlot slot={motionArt} fallbackLabel="Artwork slot" />
		</section>

		<section>
			<a
				href="/portfolio"
				class="text-lg underline hover:no-underline"
			>
				View portfolio â†’
			</a>
		</section>
	</div>
</BaseLayout>
