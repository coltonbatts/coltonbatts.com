---
import BaseLayout from '../layouts/BaseLayout.astro';
import ArtSlot from '../components/ArtSlot.astro';
import { artManifest } from '../content/art-manifest';
import { getCollection } from 'astro:content';

const tools = await getCollection('tools');
const featuredTools = tools.slice(0, 2);
const isGalleryMode = artManifest.mode === 'gallery';

function resolveToolSlot(slot: (typeof artManifest.tools)[string] | undefined) {
	if (!slot) return undefined;
	if (isGalleryMode) return slot;
	return { ...slot, enabled: slot.enabled === true };
}
---

<BaseLayout title="Home" description="Toolmaker. Building offline-first tools.">
	<div class="max-w-4xl mx-auto px-6 py-12">
		<section class="mb-16">
			<h1 class="text-3xl font-bold mb-6">Toolmaker</h1>
			<div class="prose prose-lg max-w-none">
				<p class="text-lg leading-relaxed">
					I build tools that work offline, respect your privacy, and don't require subscriptions. 
					No logins, no ads, no tracking. Just software that solves problems. 
					Think workshop manual, not SaaS landing page.
				</p>
			</div>
			<div class="mt-8">
				<ArtSlot slot={artManifest.hero} />
			</div>
		</section>

		<section class="mb-16">
			<h2 class="text-2xl font-semibold mb-6">Featured Tools</h2>
			<div class="grid gap-6 md:grid-cols-2">
				{featuredTools.map((tool) => (
					<a
						href={`/tools/${tool.slug}`}
						class="border border-black p-6 hover:bg-gray-50 transition-colors block tool-card"
					>
						<ArtSlot
							slot={resolveToolSlot(artManifest.tools[tool.slug])}
							class="mb-4"
						/>
						<h3 class="text-xl font-semibold mb-2">{tool.data.name}</h3>
						<p class="text-gray-700 mb-4">{tool.data.oneLiner}</p>
						<div class="flex items-center gap-2">
							<span
								class="text-xs px-2 py-1 border border-black"
								class:list={{
									'bg-black text-white': tool.data.status === 'active',
									'bg-gray-100': tool.data.status === 'beta',
									'bg-gray-200': tool.data.status === 'archived',
								}}
							>
								{tool.data.status}
							</span>
							<span class="text-xs text-gray-600">{tool.data.platform}</span>
						</div>
					</a>
				))}
			</div>
		</section>

		<section class="mb-16">
			<h2 class="text-2xl font-semibold mb-6">Motion</h2>
			<ArtSlot slot={artManifest.motion} />
		</section>

		<section>
			<a
				href="/portfolio"
				class="text-lg underline hover:no-underline"
			>
				View portfolio â†’
			</a>
		</section>
	</div>
</BaseLayout>
