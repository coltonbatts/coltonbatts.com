---
/**
 * [slug].astro — Tool Deep Dive
 * ==============================
 * Industrial technical manual layout for individual tools.
 *
 * Structure:
 * - Back nav with heavy border
 * - Massive title block (Inter Black, 2px bordered)
 * - Asymmetric columns: wide narrative + narrow sticky metadata
 * - IBM Plex Mono "Data Block" for tech specs / hardware
 * - Philosophy section on offline-first ownership
 * - Prev/next tool navigation
 */

import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
	const tools = await getCollection('tools');
	const statusOrder = { active: 0, beta: 1, archived: 2 };
	tools.sort((a, b) => statusOrder[a.data.status] - statusOrder[b.data.status]);

	return tools.map((tool, index) => ({
		params: { slug: tool.slug },
		props: {
			tool,
			prev: index > 0 ? tools[index - 1] : null,
			next: index < tools.length - 1 ? tools[index + 1] : null,
		},
	}));
}

const { tool, prev, next } = Astro.props;
const { Content } = await tool.render();
const {
	name, oneLiner, status, platform, version, lastUpdated,
	techStack, repoUrl, ownershipType, hardware, links, bullets, heroImage,
} = tool.data;
---

<BaseLayout title={name} description={oneLiner}>

	<!-- ============================================================
		 BACK NAV
		 ============================================================ -->
	<section class="border-b-2 border-charcoal">
		<div class="max-w-5xl mx-auto px-6 pt-8 pb-6">
			<a
				href="/tools"
				class="font-mono text-label uppercase tracking-instrument text-charcoal/40 hover:text-charcoal transition-colors"
			>
				&larr; All Tools
			</a>
		</div>
	</section>

	<!-- ============================================================
		 TITLE BLOCK — Massive, bordered, the manual's cover page
		 ============================================================ -->
	<section class="border-b-2 border-charcoal">
		<div class="max-w-5xl mx-auto px-6 pt-12 pb-10 md:pt-16 md:pb-12">

			<!-- Status / version / platform stamps -->
			<div class="flex flex-wrap items-center gap-3 mb-6">
				<span class:list={[
					'status-badge',
					{
						'status-badge--active': status === 'active',
						'status-badge--beta': status === 'beta',
						'status-badge--archived': status === 'archived',
					},
				]}>
					{status}
				</span>
				{version && (
					<span class="font-mono text-meta uppercase tracking-instrument text-charcoal/40">
						v{version}
					</span>
				)}
				<span class="font-mono text-meta uppercase tracking-instrument text-charcoal/30">
					{platform}
				</span>
			</div>

			<!-- Tool name — the steel beam -->
			<h1 class="text-display md:text-display-lg mb-4">{name}</h1>

			<!-- One-liner -->
			<p class="text-lg md:text-xl leading-relaxed max-w-3xl text-charcoal/75 mb-8">
				{oneLiner}
			</p>

			<!-- CTA row -->
			<div class="flex flex-wrap gap-4">
				{links.map((link) => (
					<a
						href={link.url}
						target="_blank"
						rel="noopener noreferrer"
						class:list={[
							'btn-instrument',
							{ 'btn-instrument--raw': link.label === 'GitHub' },
						]}
					>
						{link.label}
					</a>
				))}
			</div>
		</div>
	</section>

	<!-- ============================================================
		 HERO IMAGE — The nameplate
		 ============================================================ -->
	{heroImage && (
		<section class="border-b-2 border-charcoal">
			<div class="max-w-5xl mx-auto">
				<img
					src={heroImage}
					alt={`${name} — instrument nameplate`}
					loading="eager"
					decoding="async"
					class="w-full h-auto block"
				/>
			</div>
		</section>
	)}

	<!-- ============================================================
		 FEATURE BULLETS — Horizontal strip, monospaced
		 ============================================================ -->
	{bullets.length > 0 && (
		<section class="border-b-2 border-charcoal bg-charcoal text-manual">
			<div class="max-w-5xl mx-auto px-6 py-8">
				<ul class="grid gap-3 md:grid-cols-2 lg:grid-cols-3">
					{bullets.map((bullet) => (
						<li class="font-mono text-sm leading-relaxed text-manual/70 flex items-start gap-2">
							<span class="text-raw mt-0.5 shrink-0" aria-hidden="true">&mdash;</span>
							{bullet}
						</li>
					))}
				</ul>
			</div>
		</section>
	)}

	<!-- ============================================================
		 MAIN BODY — Asymmetric columns
		 Left: wide narrative column (markdown body)
		 Right: narrow sticky metadata + tech specs data block
		 ============================================================ -->
	<div class="max-w-5xl mx-auto px-6 py-12 md:py-22">
		<div class="grid md:grid-cols-12 gap-8 md:gap-12">

			<!-- ========== NARRATIVE COLUMN (wide) ========== -->
			<div class="md:col-span-8 order-2 md:order-1">
				<div class="prose prose-lg max-w-none text-charcoal/85 leading-relaxed">
					<Content />
				</div>
			</div>

			<!-- ========== METADATA SIDEBAR (narrow, sticky) ========== -->
			<aside class="md:col-span-4 order-1 md:order-2">
				<div class="md:sticky md:top-8 space-y-6">

					<!-- Metadata block -->
					<div class="section-block section-block--static p-6">
						<p class="section-label">Instrument Data</p>
						<dl class="space-y-4">
							{version && (
								<div>
									<dt class="font-mono text-meta uppercase tracking-instrument text-charcoal/35">Version</dt>
									<dd class="font-mono text-sm text-charcoal/80 mt-0.5">{version}</dd>
								</div>
							)}
							<div>
								<dt class="font-mono text-meta uppercase tracking-instrument text-charcoal/35">Status</dt>
								<dd class="font-mono text-sm text-charcoal/80 mt-0.5 capitalize">{status}</dd>
							</div>
							<div>
								<dt class="font-mono text-meta uppercase tracking-instrument text-charcoal/35">Platform</dt>
								<dd class="font-mono text-sm text-charcoal/80 mt-0.5">{platform}</dd>
							</div>
							{ownershipType && (
								<div>
									<dt class="font-mono text-meta uppercase tracking-instrument text-charcoal/35">Ownership</dt>
									<dd class="font-mono text-sm font-bold text-charcoal mt-0.5">{ownershipType}</dd>
								</div>
							)}
							{lastUpdated && (
								<div>
									<dt class="font-mono text-meta uppercase tracking-instrument text-charcoal/35">Last Updated</dt>
									<dd class="font-mono text-sm text-charcoal/80 mt-0.5">{lastUpdated}</dd>
								</div>
							)}
							{repoUrl && (
								<div>
									<dt class="font-mono text-meta uppercase tracking-instrument text-charcoal/35">Source</dt>
									<dd class="mt-0.5">
										<a
											href={repoUrl}
											target="_blank"
											rel="noopener noreferrer"
											class="font-mono text-sm text-raw hover:text-raw-dark transition-colors underline underline-offset-2 decoration-1"
										>
											Repository
										</a>
									</dd>
								</div>
							)}
						</dl>
					</div>

					<!-- Tech Stack data block -->
					{techStack && techStack.length > 0 && (
						<div class="section-block section-block--static p-6">
							<p class="section-label">Tech Stack</p>
							<ul class="space-y-2">
								{techStack.map((tech) => (
									<li class="font-mono text-sm text-charcoal/75 flex items-center gap-2">
										<span class="w-1.5 h-1.5 bg-charcoal/25 shrink-0" aria-hidden="true"></span>
										{tech}
									</li>
								))}
							</ul>
						</div>
					)}

					<!-- Hardware requirements data block -->
					{hardware && (
						<div class="section-block section-block--static p-6 bg-charcoal text-manual">
							<p class="font-mono text-meta uppercase tracking-instrument text-manual/40 pb-3 border-b border-manual/15 mb-4">
								Hardware Requirements
							</p>
							<dl class="space-y-4">
								<div>
									<dt class="font-mono text-meta uppercase tracking-instrument text-manual/35">Minimum</dt>
									<dd class="font-mono text-sm text-manual/75 mt-0.5">{hardware.minimum}</dd>
								</div>
								<div>
									<dt class="font-mono text-meta uppercase tracking-instrument text-manual/35">Recommended</dt>
									<dd class="font-mono text-sm text-manual/75 mt-0.5">{hardware.recommended}</dd>
								</div>
								{hardware.notes && (
									<div class="pt-3 border-t border-manual/10">
										<p class="font-mono text-xs text-manual/40 leading-relaxed">{hardware.notes}</p>
									</div>
								)}
							</dl>
						</div>
					)}

				</div>
			</aside>

		</div>
	</div>

	<!-- ============================================================
		 NAVIGATION: Previous / Next tools
		 ============================================================ -->
	<section class="border-t-2 border-charcoal">
		<div class="max-w-5xl mx-auto px-6 py-10">
			<div class="flex items-center justify-between">
				{prev ? (
					<a
						href={`/tools/${prev.slug}`}
						class="font-mono text-label uppercase tracking-instrument text-charcoal/40 hover:text-charcoal transition-colors"
					>
						&larr; {prev.data.name}
					</a>
				) : (
					<span></span>
				)}
				{next ? (
					<a
						href={`/tools/${next.slug}`}
						class="font-mono text-label uppercase tracking-instrument text-charcoal/40 hover:text-charcoal transition-colors text-right"
					>
						{next.data.name} &rarr;
					</a>
				) : (
					<span></span>
				)}
			</div>
		</div>
	</section>

</BaseLayout>
