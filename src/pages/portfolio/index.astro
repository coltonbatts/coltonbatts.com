---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PaintingCard from '../../components/PaintingCard.astro';
import { getCollection } from 'astro:content';

const paintings = await getCollection('paintings');

/** Sort by order field, then by year descending */
paintings.sort((a, b) => {
	if (a.data.order !== b.data.order) return a.data.order - b.data.order;
	return b.data.year - a.data.year;
});

/** Group paintings by series */
const seriesMap = new Map<string, typeof paintings>();
const unsorted: typeof paintings = [];

for (const painting of paintings) {
	const series = painting.data.series;
	if (series) {
		if (!seriesMap.has(series)) seriesMap.set(series, []);
		seriesMap.get(series)!.push(painting);
	} else {
		unsorted.push(painting);
	}
}

/** Total count for the header */
const totalCount = paintings.length;

/**
 * All projects get full-width treatment â€” each client
 * occupies its own row for consistent visual weight.
 */
function getGridClass(_featured: boolean, _index: number): string {
	return 'gallery-grid__item--full';
}
---

<BaseLayout title="Portfolio" description="Production & editorial work by Colton Batts.">

	<section class="">
		<div class="max-w-5xl mx-auto px-6 pt-16 pb-12 md:pt-22 md:pb-16">
			<h1 class="text-display md:text-display-lg max-w-3xl mb-8">
				Selected<br class="hidden md:block" />
				Projects.
			</h1>
			<p class="text-lg text-charcoal/70 max-w-xl leading-relaxed">
				Video production, editorial, and motion design
				for global brands.
			</p>
		</div>
	</section>

	<div class="max-w-5xl mx-auto px-6 py-16 md:py-22">

		{[...seriesMap.entries()].map(([series, seriesPaintings]) => (
			<section class="mb-20 last:mb-0">
				<div class="mb-10">
					<p class="section-label">{series}</p>
				</div>

				<div class="gallery-grid">
					{seriesPaintings.map((painting, i) => (
						<div class={getGridClass(painting.data.featured, i)}>
							<PaintingCard
								title={painting.data.title}
								medium={painting.data.medium}
								dimensions={painting.data.dimensions}
								year={painting.data.year}
								image={painting.data.image}
								slug={painting.slug}
								featured={painting.data.featured}
								available={painting.data.available}
								series={painting.data.series}
								vimeoId={painting.data.vimeoId}
							/>
						</div>
					))}
				</div>
			</section>
		))}

		{unsorted.length > 0 && (
			<section class="mb-20 last:mb-0">
				<div class="mb-10">
					<p class="section-label">Other</p>
				</div>
				<div class="gallery-grid">
					{unsorted.map((painting, i) => (
						<div class={getGridClass(painting.data.featured, i)}>
							<PaintingCard
								title={painting.data.title}
								medium={painting.data.medium}
								dimensions={painting.data.dimensions}
								year={painting.data.year}
								image={painting.data.image}
								slug={painting.slug}
								featured={painting.data.featured}
								available={painting.data.available}
								vimeoId={painting.data.vimeoId}
							/>
						</div>
					))}
				</div>
			</section>
		)}
	</div>

	<section class="bg-charcoal text-manual">
		<div class="max-w-5xl mx-auto px-6 py-16 md:py-22 flex flex-col md:flex-row md:items-center md:justify-between gap-8">
			<div>
				<p class="font-mono text-label uppercase tracking-instrument text-manual/40 mb-3">
					Inquiries
				</p>
				<h2 class="text-display-sm text-manual">Let's work together.</h2>
			</div>
			<div class="flex flex-wrap gap-4">
				<a href="mailto:colton.batts@gmail.com" class="btn-instrument border-manual/40 text-manual/70 hover:bg-manual hover:text-charcoal">
					Email
				</a>
				<a href="/contact" class="btn-instrument border-raw text-raw hover:bg-raw hover:text-manual">
					Contact
				</a>
			</div>
		</div>
	</section>

</BaseLayout>
